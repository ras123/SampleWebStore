<?
  $categories = 
    isset($parent_category) ?
    $parent_category->list_children() :
    Shop_Category::create()->list_root_children();
    
  $category_url_name = isset($category_url_name) ? $category_url_name : null;
?>
<? if ($categories->count): ?>
    
  <ul>
    <? foreach ($categories as $category): ?>
    <li class="<?= $category->is_current($category_url_name) ? 'active' : null ?>">
      <a href="<?= $category->page_url('/category') ?>"><?= h($category->name) ?></a>
      <? $this->render_partial('shop:categories', array('parent_category'=>$category)) ?>
    </li>
    <? endforeach ?>
  </ul>
<? endif ?>