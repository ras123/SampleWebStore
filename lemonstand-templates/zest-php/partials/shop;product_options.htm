<? if ($product->options->count): ?>
  <div class="clearfix">
    <?
      $index = 0;
      foreach ($product->options as $option):
        $index++;
    ?>
      <? $values = $option->list_values() ?>
      <? $control_name = 'product_options['.$option->option_key.']' ?>
      <? $posted_options = Shop_ProductHelper::get_default_options($product) ?>
      <? $posted_value = $posted_options[$option->option_key] ?>
      
      <div class="option">
        <label class="title" for="<?= 'option-'.$index ?>"><?= h($option->name) ?></label>
        <select id="<?= 'option-'.$index ?>" name="<?= $control_name ?>" data-ajax-handler="on_action" data-ajax-update="product-page=shop:product">
          <? foreach ($values as $value): ?>
            <option <?= option_state($posted_value, $value) ?> value="<?= h($value) ?>"><?= h($value) ?></option>
          <? endforeach ?>
        </select>
      </div>
    <? endforeach ?>
  </div>
<? endif ?>