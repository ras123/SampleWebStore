<? 
  $index = 0;
  foreach ($product->extra_options as $option): 
    $index++;
?>
  <? $control_name = 'product_extra_options['.$option->option_key.']' ?>
  <? $posted_options = post('product_extra_options', array()) ?>
  <? $is_checked = isset($posted_options[$option->option_key]) ?>
  
  <label for="<?= 'extra_option'.$index ?>">
    <input id="<?= 'extra_option'.$index ?>" type="checkbox" name="<?= $control_name ?>" <?= checkbox_state($is_checked) ?> value="1"/>
    <?= h($option->description) ?>:
    <span class="price">
      <? if ($option->price > 0): ?>+ <?= format_currency($option->get_price($product)) ?><? else: ?>free<? endif ?>
    </span>
  </label>
<? endforeach ?>